var m=Object.defineProperty;var d=(a,e)=>()=>(a&&(e=a(a=0)),e);var g=(a,e)=>{for(var t in e)m(a,t,{get:e[t],enumerable:!0})};var c={};g(c,{generateImage:()=>f,generatePdf:()=>p,getBrowser:()=>s});async function s(){if(process.env.VERCEL){let e=await import("@sparticuz/chromium");return(await import("puppeteer-core")).default.launch({args:[...e.default.args,"--no-sandbox","--disable-setuid-sandbox","--disable-dev-shm-usage"],defaultViewport:{width:1200,height:800},executablePath:await e.default.executablePath(),headless:!0})}return(await import("puppeteer")).default.launch({headless:!0,args:["--no-sandbox","--disable-setuid-sandbox","--disable-dev-shm-usage"]})}async function l(a){await a.setContent(await a.content(),{waitUntil:"networkidle2"}).catch(()=>{}),await a.evaluate(()=>{let t=["graph ","flowchart ","sequenceDiagram","classDiagram","stateDiagram","erDiagram","gantt","pie ","gitGraph"],r=document.querySelectorAll("pre > code, pre code");for(let n of r){let o=(n.textContent||"").trim();if(n.classList.contains("language-mermaid")||t.some(i=>o.startsWith(i)))return!0}return!1})&&await a.waitForFunction(()=>document.body.getAttribute("data-mermaid-rendered")==="true",{timeout:15e3}).catch(()=>{console.warn("Mermaid rendering timeout - continuing with available content")}),await new Promise(t=>setTimeout(t,1e3))}async function p(a,e={}){let t=await s();try{let r=await t.newPage();await r.setContent(a,{waitUntil:["networkidle2","domcontentloaded"]}),await l(r);let n=await r.pdf({format:e.format||"A4",landscape:e.landscape||!1,printBackground:e.printBackground??!0,margin:e.margin||{top:"10mm",right:"10mm",bottom:"10mm",left:"10mm"}});return Buffer.from(n)}finally{await t.close()}}async function f(a,e){let t=await s();try{let r=await t.newPage();await r.setViewport({width:1200,height:800}),await r.setContent(a,{waitUntil:["networkidle2","domcontentloaded"]}),await l(r);let n=e.type==="jpeg"?{type:"jpeg",fullPage:e.fullPage??!0,quality:e.quality??90}:{type:"png",fullPage:e.fullPage??!0},o=await r.screenshot(n);return Buffer.from(o)}finally{await t.close()}}var u=d(()=>{"use strict"});var y={runtime:"nodejs",maxDuration:60};async function w(a,e){if(a.method!=="POST")return e.status(405).json({error:"Method not allowed"});try{let{html:t,filename:r,options:n}=a.body;if(!t||typeof t!="string")return e.status(400).json({error:"Missing or invalid html"});if(!r||typeof r!="string")return e.status(400).json({error:"Missing or invalid filename"});let{generateImage:o}=await Promise.resolve().then(()=>(u(),c)),i=await o(t,{type:"jpeg",quality:n?.quality||90,fullPage:!0});return e.setHeader("Content-Type","image/jpeg"),e.setHeader("Content-Disposition",`attachment; filename="${encodeURIComponent(r)}.jpg"`),e.setHeader("Content-Length",i.length.toString()),e.setHeader("Cache-Control","no-cache, no-store, must-revalidate"),e.send(i)}catch(t){return console.error("JPEG export error:",t),e.status(500).json({error:"Failed to generate JPEG",message:t instanceof Error?t.message:"Unknown error"})}}export{y as config,w as default};
